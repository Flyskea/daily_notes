你刚刚在你梦想中的公司获得了令人羡慕的现场面试机会。招聘协调员给你发了一份当天的时间表。扫视名单，你感觉很好，直到你的目光落在这个面试环节--系统设计面试。

系统设计面试往往令人生畏。它可能像 "设计一个众所周知的产品X？"这样模糊不清。问题模棱两可，看起来不合理地宽泛。你的疲惫是可以理解的。毕竟，怎么可能有人在一个小时内设计出一个流行的产品，而这个产品是花了几百个甚至几千个工程师才建成的？  

好消息是，没有人期望你能做到。现实世界的系统设计是极其复杂的。例如，谷歌搜索具有欺骗性的简单性；然而，支撑这种简单性的技术数量确实令人吃惊。如果没有人期望你在一小时内设计出一个真实世界的系统，那么系统设计面试的好处是什么？

系统设计面试模拟了现实生活中的问题解决，两个同事合作解决一个模糊的问题，并提出了一个符合他们目标的解决方案。这个问题是开放式的，没有完美的答案。与你在设计过程中付出的努力相比，最终的设计并不那么重要。这使你能够展示你的设计技能，为你的设计选择辩护，并以建设性的方式回应反馈。

让我们换个角度来思考，考虑一下面试官进入会议室与你见面时的想法。面试官的主要目标是准确评估你的能力。她最不希望的就是因为面试过程不顺利、没有足够的信号而导致评估结果不明确。那么在系统设计面试中，面试官在寻找什么呢？

许多人认为，系统设计面试是关于一个人的技术设计能力。它远不止于此。一个有效的系统设计面试给人以强烈的信号，表明一个人的合作能力，在压力下工作的能力，以及建设性地解决模糊性的能力。提出好问题的能力也是一项重要的技能，许多面试官专门寻找这种技能。一个好的面试官也会寻找红旗。过度工程化是许多工程师的一个真正的疾病，因为他们喜欢设计的纯粹性，而忽视了权衡。他们往往没有意识到过度工程系统的复合成本，而许多公司为这种无知付出了高昂的代价。你当然不希望在系统设计面试中表现出这种倾向。其他的红旗包括狭隘的心态、固执等等。在这一章中，我们将讲述一些有用的技巧，并介绍一个简单而有效的框架来解决系统设计面试问题。  

## 系统设计面试的四个步骤

### 步骤1 - 理解问题并确定设计范围
“为什么老虎咆哮呢？”
教室后排有一只手举了起来。
“是的，吉米？”老师回答道。
“因为它饿了。”
“非常好，吉米。”
在他的童年时期，吉米总是第一个回答问题的学生。无论老师问什么问题，教室里总有一个孩子喜欢挑战问题，无论他是否知道答案。这就是吉米。

吉米是一名优秀的学生。他为能快速知道所有答案感到自豪。在考试中，他通常是第一个完成问题的人。他是老师在任何学术竞赛中首选的学生。

不要像吉米一样。

在系统设计面试中，不经思考就迅速给出答案并不会给你加分。没有深入理解需求就回答问题是一个巨大的警示信号，因为面试不是一个问答游戏。没有绝对正确的答案。

所以，请不要急于给出解决方案。放慢脚步。深入思考，并提出问题以澄清需求和假设。这非常重要。

作为一名工程师，我们喜欢解决困难的问题并直接进行最终设计；然而，这种方法很可能导致设计错误的系统。作为一名工程师，最重要的技能之一就是提出正确的问题，做出适当的假设，并收集构建系统所需的所有信息。因此，请不要害怕提问。

当你提问时，面试官要么直接回答你的问题，要么要求你做出假设。如果是后者，把你的假设写在白板或纸上。你以后可能会用到它们。

需要问什么样的问题呢？问问题是为了了解确切的需求。以下是一些问题的列表，可以帮助您开始思考：

- 我们将构建哪些具体的功能？ 
- 产品有多少用户？
- 公司预计要以多快的速度扩大规模？在3个月、6个月和一年内预计的规模是什么？ 
- 公司的技术堆栈是什么？有哪些现有的服务可以简化设计？

#### 例子

如果你被要求设计一个新闻推送系统，你想提出一些问题来帮助你理清需求。你和面试官之间的对话可能会是这样的：

**候选人**：这是一个移动应用程序吗？还是一个网页应用程序？还是两者都有？
**面试官**：两者都有。

**候选人**：对于这个产品来说，最重要的功能是什么？ 
**面试官**：能够发布帖子和查看朋友的新闻推送。 

**候选人**：新闻推送的排序是按照逆时间顺序还是特定顺序？特定顺序意味着每个帖子都有不同的权重。例如，来自你亲密朋友的帖子比来自一个群组的帖子更重要。
**面试官**：为了简化问题，我们假设推送是按照逆时间顺序排序的。

**候选人**：一个用户可以有多少个朋友？ 
**面试官**：5000个。 

**候选人**：流量有多大？ 
**面试官**：每天活跃用户有1000万。 

**候选人**：推送中可以包含图像、视频还是只能包含文本？ 
**面试官**：可以包含媒体文件，包括图像和视频。 

以上是你可以问面试官的一些问题示例。理解需求并澄清不明确的地方非常重要。

### 步骤2 - 提出高层设计并获得认可

在这一步中，我们旨在制定一个高层设计并与面试官达成共识。在整个过程中与面试官合作是一个很好的主意。

- 提出设计的初始蓝图，并征求反馈意见。把面试官当作队友，一起合作。许多优秀的面试官喜欢交流和参与。
- 在白板或纸上绘制包含关键组件的方框图。这可能包括客户端（移动端/网页端）、API、Web服务器、数据存储、缓存、CDN、消息队列等。
- 进行简单的计算，以评估蓝图是否符合规模限制。大声思考。在深入探讨之前，与面试官沟通是否需要进行这样的粗略计算。

如果可能，通过几个具体的用例来进行讨论。这将帮助您构建高层设计。同时，用例还有可能帮助您发现尚未考虑到的边缘情况。

是否应该在此处包含API端点和数据库模式？这取决于问题的具体情况。对于像“设计谷歌搜索引擎”这样的大型设计问题，这可能有点过于细节。但对于设计多人扑克游戏的后端这样的问题，这是适当的。与面试官进行沟通。

#### 例子
让我们以"设计一个新闻推送系统"为例，展示如何进行高层设计。在这里，您并不需要理解系统实际如何工作。所有的细节将在第11章中解释。在高层次上，设计分为两个流程：推送新闻和构建新闻推送。

- 推送新闻：当用户发布一篇文章时，相应的数据被写入缓存/数据库，并且该文章将被显示在朋友们的新闻推送中。 
- 构建新闻推送：新闻推送通过按逆时间顺序聚合朋友们的文章来构建。

图 3 - 1 和图 3 - 2 分别呈现了推送新闻和构建新闻推送流程的高层设计。

![[../picture/Pasted image 20230527210202.png]] ![[../picture/Pasted image 20230527210259.png]]

### 步骤3 - 深入设计

在这一步，您和面试官应该已经达到了以下目标：
- 就总体目标和功能范围达成一致
- 概述了整体设计的高层蓝图 
- 获得了面试官对高层设计的反馈 
- 基于她的反馈，对深入设计的重点领域有了一些初步想法

您应该与面试官一起确定和优先考虑体系结构中的组件。值得强调的是，每个面试都是不同的。有时，面试官可能会给出提示，她喜欢关注高级设计。有时，在对资深候选人进行面试时，讨论可能会集中在系统性能特征上，主要关注瓶颈和资源估计。在大多数情况下，面试官可能希望您深入了解一些系统组件的细节。对于URL缩短器，深入研究将长URL转换为短URL的哈希函数设计是一个有趣的话题。对于聊天系统，如何减少延迟和如何支持在线/离线状态是两个有趣的主题。

时间管理非常重要，因为很容易陷入细节中而无法展示您的能力。您必须掌握一些信号来展示给面试官。尽量不要涉及不必要的细节。例如，在系统设计面试中详细讨论Facebook的EdgeRank算法在Feed排名中并不理想，因为这需要花费大量宝贵的时间，并不能证明您设计可扩展系统的能力。

#### 例子

目前，我们已经讨论了新闻推送系统的高级设计，面试官对您的提案感到满意。接下来，我们将详细研究两个最重要的用例：

- 推送新闻
- 获取新闻推送

图 3 - 3 和图 3 - 4 展示了这两个用例的详细设计，将在第 11 章中进行详细解释。

![[../picture/Pasted image 20230527211439.png]] ![[../picture/Pasted image 20230527211454.png]]

### 步骤4 - 总结

在这最后一步，面试官可能会向您提出一些跟进问题，或者让您自由讨论其他额外的要点。以下是一些可能的方向： • 面试官可能希望您找出系统的瓶颈并讨论潜在的改进措施。永远不要说您的设计是完美的，没有任何可以改进的地方。总是有可以改进的地方。这是展示您的批判性思维并留下良好最终印象的绝佳机会。 • 如果您提出了一些解决方案，向面试官回顾您的设计可能会很有用。在长时间的会话后，向面试官回顾设计可以帮助他们回忆起之前的讨论。 • 讨论错误情况（服务器故障、网络丢失等）是有趣的话题。 • 值得一提的是运维问题。如何监控指标和错误日志？如何推出系统？ • 如何处理下一阶段的规模曲线也是一个有趣的话题。例如，如果您当前的设计支持100万用户，那么为了支持1000万用户，需要做出哪些改变？ • 如果有更多时间，可以提出其他改进意见。

最后，我们总结了一些注意事项。

#### 要做的 
- 始终要求澄清。不要假设您的假设是正确的。 
- 理解问题的需求。 
- 没有正确答案，也没有最佳答案。为解决年轻初创公司的问题设计的解决方案与为拥有数百万用户的成熟公司设计的解决方案不同。确保您理解问题的需求。 
- 让面试官了解您的思考过程。与面试官进行沟通。 
- 如有可能，提出多种方法。 
- 一旦您与面试官达成一致，就详细介绍每个组件。首先设计最关键的组件。 
- 与面试官交换想法。优秀的面试官会与您合作，作为您的团队伙伴。 
- 永远不要放弃。

#### 不要做的 
- 不要对典型的面试问题毫无准备。 
- 在澄清需求和假设之前，不要盲目提出解决方案。
- 起初不要过于详细地讨论单个组件。首先给出高级设计，然后逐步深入细节。 
- 如果遇到困难，请毫不犹豫地寻求提示。
- 再次强调，要进行沟通。不要在沉默中思考。
- 不要认为一旦给出设计就完成了面试。直到面试官说您完成了，您才算完成。及早而经常地寻求反馈。

#### 每个步骤的时间分配
系统设计面试问题通常非常广泛，45分钟或1小时的时间不足以涵盖整个设计。时间管理非常重要。在45分钟的面试时间内，您应该在每个步骤上花费多少时间？以下是一个非常粗略的指南，用于分配45分钟的面试时间。请记住，这只是一个粗略估计，实际的时间分配取决于问题的范围和面试官的要求。

步骤1：了解问题和确定设计范围：3 - 10分钟 
步骤2：提出高级设计并获得认可：10 - 15分钟 
步骤3：深入设计：10 - 25分钟 
步骤4：总结：3 - 5分钟